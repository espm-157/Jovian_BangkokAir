---
title: "finalproject"
author: "Jieyuan Kan"
date: "12/1/2021"
output: html_document
---

```{r message=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
```

Bangkok is the capital, most populous city and chief port of Thailand. The Thailand Meteorological Department divides the climate into three seasons: local summer (mid-February to mid-May), rainy season (mid-May to mid-October), and winter (mid-October to mid-February). There are two rush hour periods (7:00–9:00 a.m. and 4:00–7:00 p.m.) of the daily transportation. This final project aims to find which season has an overall higher pollution in a year and whether the local transportation correlates with the air quality in Bangkok. According to S. T. Leong, there is higher value for the pollutant concentrations at morning rush hour (7 am - 9 am). A slight decrease in pollutant concentration occurs at non-rush hour (11 am-15 pm) and a rising level of pollutants is experienced in the evening rush hour (16 pm-18 pm).

#Description on the Data Sources
1. Transportation Data

The transportation data will be from Intelligent Traffic Information Center (iITC, https://www.iticfoundation.org/). The probe-data provides vehicle unique ID, latitude and longitude coordinates, time stamp and speed from 2017 to 2020. 

2. Air Quality Data

This is the hourly air pollutant concentration data from 45 stations in Bangkok from 2017 to 2020. The atmospheric pollutants in the dataset are PM2.5, PM10, CO, NO2, SO2, O3. Based on the location, the air quality monitoring stations are divided as four types: Downtown, Urban, Suburb and Outer.

3. Weather Data

This is the hourly weather data for 2017-2021, including temperature, humidity, conditions, dew point, wind direction and wind speed. There are 35 kinds of weather conditions, namely Cloudy, Cloudy/Windy, Drizzle, Fair, Fair/Windy, Fog, Haze, Heavy Rain, etc. However, I am going to choose only weather data with wind speed less than 10km/h and the weather conditions as Fair, Cloudy, Thunder, Most Cloudy, Thunder in the Vicinity. Otherwise, the pollution will be significantly influenced by the weather factor (Dixit et al. 2021) and hard to make correlation analysis. 

#Research Questions and Analysis Tasks
1. Which season has an overall higher pollution in 2019? How can you explain that? For 2020, under the COVID-19 pandemic and quarantine requirements from the local governments, is the air quality overall in Bangkok better than 2019? 

2. Does transportation factor correlate/contribute to the air quality in Bangkok? Calculate the correlation coefficient.

3. How does the weather conditions in Bangkok influence the local air quality? In the weather dataset, which factor contributes most to the local air quality in Bangkok?

First, we import the data of air pollution into R.

```{r}
ap19_full <- read.csv("bangkok-air-quality.csv")
ap19_full
```
We can find that there are lots of NA values in the column of SO2 and CO. Therefore, I decide to remove the columns of SO2 and CO. The PM2.5, PM10, O3, and NO2 index columns are enough for the air pollution analysis.

```{r}
ap19 <- select(ap19_full,c(date, pm25, pm10, o3, no2))
ap19
```

```{r}
ap19sum <- ap19 %>%
  group_by(date) %>%
  summarise(mean_pm25 = mean(pm25),mean_pm10 = mean(pm10),mean_o3 = mean(o3),mean_no2 = mean(no2))
ap19sum
```
```{r}
ro_ap19sum <- ap19sum[c(5,4,8,1,9,7,6,2,12,11,10,3),]
ro_ap19sum
```

```{r}
ggplot(data=ap19sum, aes(x=date, y=mean_pm25, group=1)) +
  geom_line()+
  geom_line(aes(x=date, y=mean_pm10), color = "red") +
  geom_line(aes(x=date, y=mean_o3), color = "orange") +
  geom_line(aes(x=date, y=mean_no2), color = "pink") +
  labs(title = "Average Air Pollution in Bangkok 2019", x = "Date", y = "Air Pollution") +
  theme(legend.position = c(0, 0.1),legend.justification = c(0, 0.1))+
  scale_x_discrete(limits = c("Jan-19", "Feb-19", "Mar-19","Apr-19","May-19","Jun-19","Jul-19","Aug-19","Sep-19","Oct-19","Nov-19","Dec-19"))
```
As we can see from the graph, the local winter season (from October to next year's February) has overall higher air pollution in all of the four indexes. When Bangkok is in winter, the air temperature will be lower. The density of cold air is higher than that of cold air, so cold air moves slower than warm air. Then the pollutants in the air also move slower in winter, and they will be trapped in the original places. Therefore, the air pollution in winter will be higher than summer. 










